<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Seeker Dashboard - JobPortal Pro</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <script>
        // Check authentication on page load
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const user = JSON.parse(localStorage.getItem('currentUser'));
                if (!user || !user.token || user.type !== 'jobseeker') {
                    throw new Error('Not authenticated as jobseeker');
                }

                const response = await fetch('http://localhost:8000/verify-token', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${user.token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Invalid token');
                }

                const data = await response.json();
                if (data.user_type !== 'jobseeker') {
                    throw new Error('Not a jobseeker account');
                }

                // Set welcome message
                document.getElementById('welcome-message').textContent = `Welcome, ${user.email}`;
                
                // Initialize dashboard
                initJobseekerDashboard().catch(error => {
                    console.error('Failed to initialize dashboard:', error);
                });
            } catch (error) {
                console.error('Authentication failed:', error);
                window.location.href = 'index.html';
            }
        });
    </script>
    <div class="dashboard">
        <div class="dashboard-header">
            <div class="dashboard-logo">JobPortal Pro - Job Seeker</div>
            <div class="user-info">
                <div class="user-avatar">J</div>
                <span id="welcome-message">Welcome</span>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>
        
        <div class="dashboard-content">
            <!-- Profile Management Section -->
            <div class="profile-section">
                <h2 class="section-title">üë§ Profile Management</h2>
                <div class="profile-grid">
                    <div>
                        <div class="input-group">
                            <label for="user-name">Full Name *</label>
                            <input type="text" id="user-name" placeholder="Enter your full name">
                        </div>
                        <div class="input-group">
                            <label for="user-email">Email Address</label>
                            <input type="email" id="user-email" value="jobseeker@example.com" readonly>
                        </div>
                        <div class="input-group">
                            <label for="user-phone">Phone Number *</label>
                            <input type="tel" id="user-phone" placeholder="Enter phone number">
                        </div>
                        <div class="input-group">
                            <label for="user-location">Location *</label>
                            <input type="text" id="user-location" placeholder="City, State, Country">
                        </div>
                    </div>
                    <div>
                        <div class="input-group">
                            <label for="user-experience">Experience Level</label>
                            <select id="user-experience">
                                <option value="">Select Experience</option>
                                <option value="0-1">0-1 years (Fresher)</option>
                                <option value="1-3">1-3 years</option>
                                <option value="3-5">3-5 years</option>
                                <option value="5-10">5-10 years</option>
                                <option value="10+">10+ years</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="user-education">Education</label>
                            <input type="text" id="user-education" placeholder="e.g., B.Tech Computer Science, BCA, MCA">
                        </div>
                        <div class="input-group">
                            <label for="user-current-role">Current/Last Role</label>
                            <input type="text" id="user-current-role" placeholder="e.g., Software Developer, Analyst">
                        </div>
                        <div class="input-group">
                            <label for="user-salary">Expected Salary (LPA)</label>
                            <input type="text" id="user-salary" placeholder="e.g., 5-8 LPA">
                        </div>
                        <button class="login-btn" onclick="saveProfile()">üíæ Save Profile</button>
                    </div>
                </div>
            </div>
            
            <!-- Skills Management Section -->
            <div class="profile-section">
                <h2 class="section-title">üõ†Ô∏è Skills Management</h2>
                <p style="color: #718096; margin-bottom: 20px;">
                    Add your technical and soft skills to improve job matching accuracy.
                </p>
                <div class="skill-input-container">
                    <input type="text" id="skill-input" placeholder="Enter a skill (e.g., Python, JavaScript, Communication, etc.)">
                    <button class="add-skill-btn" onclick="addSkill()">‚ûï Add Skill</button>
                </div>
                
                <!-- Skill suggestions -->
                <div style="margin-bottom: 20px;">
                    <small style="color: #718096;">Popular skills:</small><br>
                    <button class="skill-suggestion" onclick="addSuggestedSkill('Python')">Python</button>
                    <button class="skill-suggestion" onclick="addSuggestedSkill('JavaScript')">JavaScript</button>
                    <button class="skill-suggestion" onclick="addSuggestedSkill('React')">React</button>
                    <button class="skill-suggestion" onclick="addSuggestedSkill('Node.js')">Node.js</button>
                    <button class="skill-suggestion" onclick="addSuggestedSkill('SQL')">SQL</button>
                    <button class="skill-suggestion" onclick="addSuggestedSkill('Java')">Java</button>
                </div>
                
                <div class="skills-display" id="skills-display">
                    <p style="color: #718096;">No skills added yet. Add your skills to improve job matching.</p>
                </div>
            </div>
            
            <!-- Resume Management Section -->
            <div class="profile-section">
                <h2 class="section-title">üìÑ Resume Management</h2>
                <div class="profile-grid">
                    <div>
                        <h3 style="margin-bottom: 15px;">üìÅ Upload Existing Resume</h3>
                        <div class="resume-upload-area" onclick="triggerFileUpload()" 
                             ondrop="handleFileDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                            <div class="upload-icon">üìÅ</div>
                            <p><strong>Click to upload</strong> or drag & drop your resume</p>
                            <p style="font-size: 0.9rem; color: #718096;">PDF, DOC, DOCX files accepted (Max 5MB)</p>
                        </div>
                        <input type="file" id="resume-file" accept=".pdf,.doc,.docx" style="display: none;" onchange="handleFileUpload(event)">
                        <div id="uploaded-resume" style="display: none; margin-top: 15px;">
                            <p style="color: #48bb78; font-weight: 600;">‚úÖ Resume uploaded successfully!</p>
                            <div style="margin-top: 10px;">
                                <button class="search-btn" onclick="viewResume()">üëÅÔ∏è View Resume</button>
                                <button class="search-btn" onclick="deleteResume()" style="background: #e53e3e; margin-left: 10px;">üóëÔ∏è Delete</button>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 style="margin-bottom: 15px;">üé® Create New Resume</h3>
                        <div class="resume-builder">
                            <div class="form-row">
                                <textarea id="resume-objective" placeholder="Career Objective - Describe your career goals and aspirations" rows="3"></textarea>
                            </div>
                            <div class="form-row">
                                <input type="text" id="resume-company" placeholder="Current/Previous Company">
                                <input type="text" id="resume-duration" placeholder="Duration (e.g., Jan 2020 - Present)">
                            </div>
                            <div class="form-row">
                                <textarea id="resume-description" placeholder="Job Description & Key Achievements - Describe your responsibilities and accomplishments" rows="4"></textarea>
                            </div>
                            <div class="form-row">
                                <input type="text" id="resume-projects" placeholder="Key Projects (comma separated)">
                                <input type="text" id="resume-certifications" placeholder="Certifications & Awards">
                            </div>
                            <div class="form-row">
                                <textarea id="resume-additional" placeholder="Additional Information - Languages, Hobbies, etc." rows="2"></textarea>
                            </div>
                            <button class="generate-resume-btn" onclick="generateResume()">üöÄ Generate Resume</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Job Preferences Section -->
            <div class="profile-section">
                <h2 class="section-title">üéØ Job Preferences</h2>
                <div class="profile-grid">
                    <div>
                        <div class="input-group">
                            <label for="preferred-role">Preferred Job Role</label>
                            <input type="text" id="preferred-role" placeholder="e.g., Software Developer, Data Analyst">
                        </div>
                        <div class="input-group">
                            <label for="preferred-industry">Preferred Industry</label>
                            <select id="preferred-industry">
                                <option value="">Select Industry</option>
                                <option value="technology">Technology</option>
                                <option value="finance">Finance</option>
                                <option value="healthcare">Healthcare</option>
                                <option value="education">Education</option>
                                <option value="ecommerce">E-commerce</option>
                                <option value="consulting">Consulting</option>
                                <option value="startup">Startup</option>
                                <option value="government">Government</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <div class="input-group">
                            <label for="work-mode">Work Mode Preference</label>
                            <select id="work-mode">
                                <option value="">Any Mode</option>
                                <option value="remote">Remote</option>
                                <option value="hybrid">Hybrid</option>
                                <option value="onsite">On-site</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="job-type">Job Type</label>
                            <select id="job-type">
                                <option value="">Any Type</option>
                                <option value="full-time">Full Time</option>
                                <option value="part-time">Part Time</option>
                                <option value="contract">Contract</option>
                                <option value="internship">Internship</option>
                            </select>
                        </div>
                        <button class="login-btn" onclick="saveJobPreferences()">üíæ Save Preferences</button>
                    </div>
                </div>
            </div>

            <!-- Job Search Section -->
            <div class="job-search-container card">
                <div class="job-search-header">
                    <h3>Advanced Job Search</h3>
                    <p>Use our semantic search to find the perfect job for you.</p>
                </div>
                <div class="job-search-box">
                    <input type="text" id="job-search-input" placeholder="e.g., 'marketing manager in london with 5 years experience'">
                    <button class="search-btn" id="search-jobs-btn" onclick="searchJobs()">Search</button>
                </div>
                <div class="job-filters">
                    <div class="filter-group">
                        <label for="filter-location">Location</label>
                        <input type="text" id="filter-location" placeholder="City or 'remote'">
                    </div>
                    <div class="filter-group">
                        <label for="filter-company">Company</label>
                        <input type="text" id="filter-company" placeholder="Company name">
                    </div>
                    <div class="filter-group">
                        <label for="filter-salary">Min Salary ($)</label>
                        <input type="number" id="filter-salary" placeholder="e.g., 80000">
                    </div>
                </div>
            </div>
            <div id="job-listings" class="job-listings-container">
                <!-- Job listings will be dynamically inserted here -->
            </div>

            <!-- My Applications Section -->
            <div class="applications-section">
                <h2 class="section-title">My Applications</h2>
                <div id="my-applications-list">
                    <!-- Application cards will be dynamically inserted here -->
                </div>
                <div id="no-applications-message" style="display: none; text-align: center; padding: 20px; color: #718096;">
                    You have not applied to any jobs yet.
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="dashboard.js"></script>
    <script>
        // Initialize job seeker specific functions
        let uploadedResumeData = null;
        
        // Skill suggestion function
        function addSuggestedSkill(skill) {
            document.getElementById('skill-input').value = skill;
            addSkill();
        }
        
        // Save job preferences
        async function saveJobPreferences() {
            const preferredRole = document.getElementById('preferred-role').value;
            const preferredIndustry = document.getElementById('preferred-industry').value;
            const workMode = document.getElementById('work-mode').value;
            const jobType = document.getElementById('job-type').value;
            
            const preferencesData = {
                preferred_role: preferredRole,
                preferred_industry: preferredIndustry,
                work_mode: workMode,
                job_type: jobType
            };

            try {
                const user = JSON.parse(localStorage.getItem('currentUser'));
                const response = await fetch('http://localhost:8000/jobseeker/preferences', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${user.token}`
                    },
                    body: JSON.stringify(preferencesData)
                });

                if (response.ok) {
                    alert('Job preferences saved successfully!');
                } else {
                    const errorData = await response.json();
                    alert(`Failed to save job preferences: ${errorData.detail}`);
                }
            } catch (error) {
                console.error('Failed to save job preferences:', error);
                alert('An error occurred while saving your job preferences. Please try again later.');
            }
        }
        
        // Delete uploaded resume
        function deleteResume() {
            if (confirm('Are you sure you want to delete the uploaded resume?')) {
                document.getElementById('uploaded-resume').style.display = 'none';
                document.getElementById('resume-file').value = '';
                uploadedResumeData = null;
                if (currentUser) {
                    currentUser.resume = null;
                }
                alert('Resume deleted successfully!');
            }
        }
        
        // Enhanced file upload with validation
        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                // Validate file size (5MB max)
                if (file.size > 5 * 1024 * 1024) {
                    alert('File size too large. Please upload a file smaller than 5MB.');
                    return;
                }
                
                // Validate file type
                const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
                if (!allowedTypes.includes(file.type)) {
                    alert('Invalid file type. Please upload PDF, DOC, or DOCX files only.');
                    return;
                }

                const formData = new FormData();
                formData.append("file", file);

                try {
                    const user = JSON.parse(localStorage.getItem('currentUser'));
                    const response = await fetch('http://localhost:8000/jobseeker/resume', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${user.token}`
                        },
                        body: formData
                    });

                    if (response.ok) {
                        document.getElementById('uploaded-resume').style.display = 'block';
                        uploadedResumeData = { name: file.name, type: file.type, size: file.size };
                        alert('Resume uploaded successfully!');
                    } else {
                        const errorData = await response.json();
                        alert(`Failed to upload resume: ${errorData.detail}`);
                    }
                } catch (error) {
                    console.error('Failed to upload resume:', error);
                    alert('An error occurred while uploading your resume. Please try again later.');
                }
            }
        }
        
        // Enhanced resume generation
        function generateResume() {
            const objective = document.getElementById('resume-objective').value;
            const company = document.getElementById('resume-company').value;
            const duration = document.getElementById('resume-duration').value;
            const description = document.getElementById('resume-description').value;
            const projects = document.getElementById('resume-projects').value;
            const certifications = document.getElementById('resume-certifications').value;
            const additional = document.getElementById('resume-additional').value;
            
            if (!objective || !description) {
                alert('Please fill in at least the Career Objective and Job Description fields');
                return;
            }
            
            // Enhanced resume generation with progress
            const generateBtn = document.querySelector('.generate-resume-btn');
            const originalText = generateBtn.textContent;
            generateBtn.textContent = 'üîÑ Generating Resume...';
            generateBtn.disabled = true;
            
            setTimeout(() => {
                alert('‚úÖ Resume generated successfully! You can now download it.');
                generateBtn.textContent = 'üì• Download Resume';
                generateBtn.onclick = function() {
                    downloadResume();
                };
                generateBtn.disabled = false;
                
                // Save enhanced resume data
                if (currentUser) {
                    currentUser.generatedResume = {
                        objective, company, duration, description, projects, certifications, additional,
                        skills: userSkills,
                        profile: currentUser.profile,
                        jobPreferences: currentUser.jobPreferences,
                        generatedDate: new Date().toLocaleDateString()
                    };
                }
            }, 3000);
        }
        
        // Enhanced resume content creation
        function createResumeContent() {
            const data = currentUser.generatedResume;
            const profile = currentUser.profile || {};
            const preferences = currentUser.jobPreferences || {};
            
            return `
==============================================
              PROFESSIONAL RESUME
==============================================

${profile.name || '[Your Name]'}
Email: ${currentUser.email}
Phone: ${profile.phone || '[Your Phone]'}
Location: ${profile.location || '[Your Location]'}
${preferences.preferredRole ? 'Seeking: ' + preferences.preferredRole : ''}

==============================================
CAREER OBJECTIVE
==============================================
${data.objective}

==============================================
PROFESSIONAL EXPERIENCE
==============================================
${data.company ? 'Company: ' + data.company : ''}
${data.duration ? 'Duration: ' + data.duration : ''}
${profile.currentRole ? 'Role: ' + profile.currentRole : ''}

${data.description}

==============================================
TECHNICAL SKILLS
==============================================
${userSkills.join(' ‚Ä¢ ') || '[Your Skills]'}

==============================================
KEY PROJECTS
==============================================
${data.projects || '[Your Projects]'}

==============================================
CERTIFICATIONS & ACHIEVEMENTS
==============================================
${data.certifications || '[Your Certifications]'}

==============================================
EDUCATION
==============================================
${profile.education || '[Your Education]'}
${profile.experience ? 'Experience Level: ' + profile.experience : ''}

==============================================
JOB PREFERENCES
==============================================
${preferences.preferredIndustry ? 'Preferred Industry: ' + preferences.preferredIndustry : ''}
${preferences.workMode ? 'Work Mode: ' + preferences.workMode : ''}
${preferences.jobType ? 'Job Type: ' + preferences.jobType : ''}
${profile.salary ? 'Expected Salary: ' + profile.salary : ''}

${data.additional ? '=============================================='
+ '\nADDITIONAL INFORMATION'
+ '\n=============================================='
+ '\n' + data.additional : ''}

Generated on: ${data.generatedDate}
Generated by: JobPortal Pro - Smart Job Portal
            `;
        }
        

    </script>
</body>
</html>